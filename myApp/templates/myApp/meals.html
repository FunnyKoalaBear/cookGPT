{% extends 'myApp/layout.html' %}

{% load static %} 

{% block body %}

    <style>
      .hide-scrollbar {
        scrollbar-width: none; /* Firefox */
        -ms-overflow-style: none; /* IE 10+ */
      }
      .hide-scrollbar::-webkit-scrollbar {
        display: none; /* Chrome, Safari, Opera */
      }
    </style>

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="{% static 'myApp/CookGPT.css' %}" rel="stylesheet">

    <!-- script to parse the recipe recieved to display niceley in html -->
    <script>
      function recipeStringToHTML(recipeString) {
        // Split into ingredients and instructions parts
        let [ingPart, instPart] = recipeString.split("<b>Instructions:</b>");

        // Extract ingredients
        let ingredients = ingPart
          .split("<br>")
          .filter(line => line.trim().startsWith("-"))
          .map(line => line.replace("-", "").trim());

        // Extract instructions
        let instructions = instPart
          .split("<br>")
          .filter(line => /^\d+\./.test(line.trim()))
          .map(line => line.trim());

        // Build HTML
        let html = "<h2>Ingredients:</h2><ul>";
        html += ingredients.map(i => `<li>${i}</li>`).join("");
        html += "</ul>";

        html += "<h2>Instructions:</h2><ol>";
        html += instructions.map(step => `<li>${step.replace(/^\d+\.\s*/, "")}</li>`).join("");
        html += "</ol>";

        return html;
      }

    </script>


    <style>
        body {
            /* background-image: url("{% static 'myApp/background3.jpg' %}?v=2"); */
            background-color: rgb(255, 240, 33);
            background-size: cover;
            background-repeat: no-repeat;
            overflow: hidden;
            background-position: center;
        }
    </style>
    
    
    <br>

    <br>

    <div class="min-h-screen p-6">
        <h1 class="text-3xl font-bold mb-6 text-center">üçΩÔ∏è Your Favorite Meals</h1>
      
            <!-- Centering Wrapper -->
        <div class="flex justify-center">
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-20 overflow-y-auto hide-scrollbar max-h-[80vh] px-2 max-w-5xl">


                {% for recipe in recipes %}
                  <!-- Meal Card -->
                  <div id="recipe.{{ recipe.id }}" class="bg-white rounded-2xl shadow-lg p-5 border border-gray-300 w-full max-w-3xl">
                    
                    <h2 class="text-xl font-semibold mb-2">{{ recipe.recipeTitle }}</h2>
                    <p class="text-gray-700 mb-4">{{ recipe.recipe|safe }}</p>

                    <form data-id="{{ recipe.id }}" class="remove-recipe-form" action="{% url 'removeRecipe' recipe.id %}" method="POST">
                        {% csrf_token %}
                        <button type="submit" 
                            class="flex justify-center mt-6 bg-red-500 hover:bg-red-600 text-white py-2 px-4 rounded-md">
                            Remove Recipe
                        </button>
                    </form>

                  </div>
                {% endfor %}

            </div>
                
        </div>
      </div>

      <!-- script to remove recipes -->
      <script>
        document.querySelectorAll('.remove-recipe-form').forEach(form => {
            form.addEventListener('submit', function (e) {
                e.preventDefault(); // stop normal form submit

                const recipeId = this.dataset.id;
                const url = this.action;
                const csrfToken = this.querySelector('[name=csrfmiddlewaretoken]').value;

                fetch(url, {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': csrfToken,
                        'X-Requested-With': 'XMLHttpRequest'
                    }
                })
                .then(response => {
                    if (response.ok) {
                        document.getElementById(`recipe.${recipeId}`).style.display = 'none';
                    } else {
                        console.error('Failed to remove recipe');
                    }
                })
                .catch(error => console.error('Error:', error));
            });
          });
      </script>
      
      
    
{% endblock %}
